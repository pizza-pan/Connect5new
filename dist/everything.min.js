"use strict";angular.module("myApp").service("gameLogic",function(){function a(a,b){return angular.equals(a,b)}function b(a){return angular.copy(a)}function c(){var a,b=[];for(a=0;15>a;a++)b[b.length]=["","","","","","","","","","","","","","",""];return b}function d(a,b,c,d){var e,f=[[b,c]];for(e=1;15>e&&(15>c+e&&a[b][c+e]===d);e++)f[f.length]=[b,c+e];for(e=1;15>e&&(c-e>=0&&a[b][c-e]===d);e++)f[f.length]=[b,c-e];return f}function e(a,b,c,d){var e,f=[[b,c]];for(e=1;15>e&&(15>c+e&&15>b+e&&a[b+e][c+e]===d);e++)f[f.length]=[b+e,c+e];for(e=1;15>e&&(c-e>=0&&b-e>=0&&a[b-e][c-e]===d);e++)f[f.length]=[b-e,c-e];return f}function f(a,b,c,d){var e,f=[[b,c]];for(e=1;15>e&&(c-e>=0&&15>b+e&&a[b+e][c-e]===d);e++)f[f.length]=[b+e,c-e];for(e=1;15>e&&(15>c+e&&b-e>=0&&a[b-e][c+e]===d);e++)f[f.length]=[b-e,c+e];return f}function g(a,b,c,d){var e,f=[[b,c]];for(e=1;15>e&&(15>b+e&&a[b+e][c]===d);e++)f[f.length]=[b+e,c];for(e=1;15>e&&(b-e>=0&&a[b-e][c]===d);e++)f[f.length]=[b-e,c];return f}function h(a){return a.length>0?a[0]:""}function i(a,b,c,h){var i=[];return 5===d(a,b,c,h).length?i=[h,d(a,b,c,h)]:5===g(a,b,c,h).length?i=[h,d(a,b,c,h)]:5===e(a,b,c,h).length?i=[h,d(a,b,c,h)]:5===f(a,b,c,h).length?i=[h,d(a,b,c,h)]:i}function j(a){var b,c;for(b=0;15>b;b++)for(c=0;15>c;c++)if(""===a[b][c])return!1;return!0}function k(a,d,e,f){if(void 0===a&&(a=c()),""!==a[d][e])throw new Error("One can only make a move in an empty position!");var g=b(a),k=0===f?"X":"O";g[d][e]=k;var l,m=h(i(g,d,e,k));return l=""!==m||j(g)?{endMatch:{endMatchScores:"X"===m?[1,0]:"O"===m?[0,1]:[0,0]}}:{setTurn:{turnIndex:1-f}},[l,{set:{key:"board",value:g}},{set:{key:"delta",value:{row:d,col:e}}}]}function l(b){var c=b.move,d=b.turnIndexBeforeMove,e=b.stateBeforeMove;try{var f=c[2].set.value,g=f.row,h=f.col,i=e.board,j=k(i,g,h,d);if(!a(c,j))return!1}catch(l){return!1}return!0}function m(a,b,c){for(var d=[],e=b,f=a,g=0;g<c.length;g++){var h=c[g],i=k(e.board,h.row,h.col,f),j={board:i[1].set.value,delta:i[2].set.value};d.push({stateBeforeMove:e,stateAfterMove:j,turnIndexBeforeMove:f,turnIndexAfterMove:1-f,move:i,comment:{en:h.comment}}),e=j,f=1-f}return d}function n(){return[m(0,{board:[["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","X","X","X","","","","","","","","","",""],["","","O","O","O","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""]],delta:{row:3,col:4}},[{row:2,col:5,comment:"Find the position for X where he could win in his next turn by having 5 connected Xs in one direction"},{row:2,col:1,comment:"O played to try to block X"},{row:2,col:6,comment:"X wins by having five Xs in one direction."}]),m(1,{board:[["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","X","X","X","","","","","","","","","",""],["","","","O","O","O","X","","","","","","","",""],["","","","O","","X","X","","","","","","","",""],["","","","","O","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""]],delta:{row:3,col:4}},[{row:3,col:2,comment:"O places here will lead to winning in 2 more rounds"},{row:3,col:1,comment:"X places here to avoid O from winning"},{row:2,col:1,comment:"O will win next round."},{row:1,col:2,comment:"X played to try to block O"},{row:6,col:5,comment:"O wins by having five Os in one direction."}])]}function o(){return m(0,{},[{row:6,col:6,comment:"X starts the game by placing near the middle of the board"},{row:7,col:6,comment:"O places next to the X's first move"},{row:6,col:7,comment:"X plces next to its first move"},{row:7,col:7,comment:"O places next to its original move"},{row:8,col:9,comment:"X places on 8, 9"},{row:7,col:8,comment:"O forms an open three on 7, 8"},{row:7,col:9,comment:"X blocks O by putting on 7, 9"},{row:8,col:6,comment:"O places on 8, 6"},{row:6,col:9,comment:"X places on 6,9 and forming two open threes, X will win"},{row:6,col:8,comment:"O trying to block X by placing on 6,8"},{row:5,col:9,comment:"X places on 5,9, forming an open four"},{row:4,col:9,comment:"O tring to block X by putting on 4, 9"},{row:9,col:9,comment:"X wins by placing at 9, 9"}])}this.createMove=k,this.isMoveOk=l,this.getExampleGame=o,this.getRiddles=n}),window.touchElementId="score-sheets",angular.module("myApp",["ngTouch"]).controller("Ctrl",["$rootScope","$window","$scope","$log","$timeout","aiService","gameService","gameLogic","resizeGameAreaService","dragAndDropService",function(a,b,c,d,e,f,g,h,i,j){function k(a){c.board=a.stateAfterMove.board,c.delta=a.stateAfterMove.delta,a.stateAfterMove.delta&&(c.newMove=[a.stateAfterMove.delta.row,a.stateAfterMove.delta.col]),void 0===c.board?(c.numOfMoves=0,c.isAiWorking=!1,c.board=[["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","",""]]):d.info(["sound played on Board:",c.board]),c.isYourTurn=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,c.turnIndex=a.turnIndexAfterMove,r(),c.isYourTurn&&""===a.playersInfo[a.yourPlayerIndex].playerId&&(d.info("computer turn"),c.isAiWorking=!0,e(l,600))}function l(){d.info("computer moved");var a=[];a=c.numOfMoves<2?u():t(),c.newMove=a,g.makeMove(h.createMove(c.board,a[0],a[1],c.turnIndex)),f.informingComputer(a[0],a[1],"white"),e(r,500),c.numOfMoves++}function m(a,b,d){{var e=document.getElementById("draggingLines"),f=document.getElementById("horizontalDraggingLine"),g=document.getElementById("verticalDraggingLine"),h=document.getElementById("gameArea"),i=b-h.offsetLeft,j=d-h.offsetTop;document.getElementById("button")}if(0>i||i>=h.clientWidth||0>j||j>=h.clientHeight)return e.style.displagy="none",void(clickToDragPiece.style.display="none");var k=Math.floor(w*i/h.clientWidth),l=Math.floor(v*j/h.clientHeight);if("X"!==c.board[l][k]&&"O"!==c.board[l][k]){clickToDragPiece.style.display="inline",e.style.display="inline";var m=p(l,k);g.setAttribute("x1",m.x),g.setAttribute("x2",m.x),f.setAttribute("y1",m.y),f.setAttribute("y2",m.y);var o=n(l,k),r=document.getElementById("circle");r.setAttribute("fill",0===c.turnIndex?"black":"white"),clickToDragPiece.style.left=o.left+"px",clickToDragPiece.style.top=o.top+"px",("touchend"===a||"touchcancel"===a||"touchleave"===a||"mouseup"===a)&&(clickToDragPiece.style.display="none",e.style.display="none",q(l,k))}}function n(a,b){var c=o();return{top:a*c.height,left:b*c.width}}function o(){var a=document.getElementById("gameArea");return{width:a.clientWidth/w,height:a.clientHeight/v}}function p(a,b){var c=o();return{x:b*c.width+c.width/2,y:a*c.height+c.height/2}}function q(b,e){a.$apply(function(){var a="Dragged to "+b+"x"+e;d.info(a),c.msg=a,c.cellClicked(b,e)})}function r(){c.isAiWorking=!1}function s(){f.iniComputer()}function t(){return f.getMove()}function u(){for(var a=[[6,6],[6,7],[6,8],[7,6],[7,7],[7,8],[8,6],[8,7],[8,8]];;){var b=Math.floor(Math.random()*a.length);if(""===c.board[a[b][0]][a[b][1]])return[a[b][0],a[b][1]];a.splice(b,1)}}i.setWidthToHeight(1),c.getIntegersTill=function(a){for(var b=[],c=0;a>c;c++)b.push(c);return b},j.addDragListener("gameArea",m);var v=15,w=15;k({stateAfterMove:{},turnIndexAfterMove:0,yourPlayerIndex:-2}),s(),c.placeDot=function(a,b,d){return""===a?"img/empty.png":"X"===a?b===c.newMove[0]&&d===c.newMove[1]?"img/newblackStone.png":"img/blackStone.png":"O"===a?b===c.newMove[0]&&d===c.newMove[1]?"img/newwhiteStone.png":"img/whiteStone.png":void 0},c.shouldSlowlyAppear=function(a,b){return void 0!==c.delta&&c.delta.row===a&&c.delta.col===b},c.cellClicked=function(a,b){if(d.info(["Clicked on cell:",a,b]),c.isYourTurn)try{if(c.isAiWorking)return!1;c.isAiWorking=!0;var e=h.createMove(c.board,a,b,c.turnIndex);c.newMove=[a,b],c.isYourTurn=!1,g.makeMove(e),c.numOfMoves++,f.informingComputer(a,b,"black")}catch(i){return void d.info(["Cell is already full in position:",a,b])}},c.onStartCallback=function(){d.info("onStart happened!",arguments)},g.setGame({gameDeveloperEmail:"punk0706@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:h.isMoveOk,updateUI:k})}]),angular.module("myApp").service("aiService",function(){function a(a,b){this.r=a,this.c=b,this.set=!1,this.score=0,this.valid=!1,this.info=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]}function b(){return String.fromCharCode.apply(null,l)}function c(a){void 0===a?f.ini("hard","white"):f.ini(a,"white")}function d(a,b,c){f.watch(a,b,c)}function e(){var a=f.move();return a}var f={};f.sum=0,f.setNum=0,f.scoreMap=[],f.scorequeue=[],f.map=[];for(var g=0;15>g;g++){for(var h=[],i=0;15>i;i++){var j=new a(g,i);h.push(j),f.scorequeue.push(j)}f.map.push(h)}var k=new ArrayBuffer(255),l=new Uint8Array(k);f.ini=function(a,b){switch(this.color=b,this.otc="black"==b?"white":"black",a){case"easy":this.depth=5,this.totry=[12,8];break;case"hard":this.depth=7,this.totry=[10,10];break;default:console.log("ini erro")}console.log("ini complete")},f.watch=function(a,b,c){this.updateMap(a,b,c),"remove"==c?this.setNum--:this.setNum++,this.scorequeue.sort(this.sortMove)},f.updateMap=function(a,b,c){var d,e=!1;return c==this.color?d=1:c==this.otc?d=0:(e=!0,d=this.map[a][b].set-1),this._updateMap(a,b,d,e)},f.moves=[[-1,-1],[-1,0],[0,-1],[-1,1]],f.coe=[-2,1],f.scores=[0,1,10,2e3,4e3,1e11],f._updateMap=function(a,b,c,d){var e,f,g,h,i,j,k,m,n,o=this.moves,p=this.coe,q=this.scores,r=4,s=0;if(d)for(l[15*a+b]=0,this.map[a][b].set=!1;r--;)for(e=a,f=b,g=5;g--&&e>=0&&f>=0&&15>f;)if(i=e-4*o[r][0],j=f-4*o[r][1],i>=15||0>j||j>=15)e+=o[r][0],f+=o[r][1];else{k=this.map[e][f].info[r];var t=0;if(k[c]--,k[2]>0){for(h=5,i=e,j=f,m=q[k[2]],s-=m*k[3];h--;)this.map[i][j].score-=m,i-=o[r][0],j-=o[r][1];k[2]--,k[c]>0&&(t=1)}else k[1-c]>0&&!k[c]&&(t=-1);if(1===t)for(h=5,m=q[k[2]],i=e,j=f,s+=m*k[3];h--;)this.map[i][j].score+=m,i-=o[r][0],j-=o[r][1];else if(-1===t)for(k[2]=k[1-c],h=5,m=q[k[2]],k[3]=p[1-c],i=e,j=f,s+=m*k[3];h--;)this.map[i][j].score+=m,i-=o[r][0],j-=o[r][1];e+=o[r][0],f+=o[r][1]}else for(l[15*a+b]=c+2,this.map[a][b].set=c+1;r--;)for(e=a,f=b,g=5;g--&&e>=0&&f>=0&&15>f;)if(i=e-4*o[r][0],j=f-4*o[r][1],i>=15||0>j||j>=15)e+=o[r][0],f+=o[r][1];else{if(k=this.map[e][f].info[r],k[2]>0)for(h=5,i=e,j=f,m=q[k[2]],s-=m*k[3];h--;)this.map[i][j].score-=m,i-=o[r][0],j-=o[r][1];if(k[c]++,k[1-c]>0)k[2]=0;else for(k[2]=k[c],n=p[c],k[3]=n,m=q[k[2]],h=5,i=e,j=f,s+=m*k[3];h--;)this.map[i][j].score+=m,i-=o[r][0],j-=o[r][1];e+=o[r][0],f+=o[r][1]}this.sum+=s},f.simulate=function(a,b,c){this.setNum++,this._updateMap(a,b,c,!1)},f.desimulate=function(a,b,c){this._updateMap(a,b,c,!0),this.setNum--},f.sortMove=function(a,b){return a.set?1:b.set?-1:a.score<b.score?1:-1},f.cache={},f.nega=function(a,c,d,e,f){var g=(this.map[a][c].info,4),h=d%2;this.simulate(a,c,h);var i=b();if(this.cache[i])return this.cache[i];if(Math.abs(this.sum)>=1e7)return-1/0;if(225===this.setNum)return 0;if(0===d)return this.sum;this.scorequeue.sort(this.sortMove);for(var j,g=this.totry[h],k=[],l=f;g--;)j=this.scorequeue[g],j.set||(k.push(j.c),k.push(j.r));d-=1,g=k.length-1,a=k[g],c=k[--g];var m=-this.nega(a,c,d,-l,-e);if(this.desimulate(a,c,d%2),m>e&&(i=b(),this.cache[i]=m,e=m),e>=f)return i=b(),this.cache[i]=f,e;for(l=e+1;g--;){if(a=k[g],c=k[--g],m=-this.nega(a,c,d,-l,-e),this.desimulate(a,c,d%2),m>e&&f>m&&(m=-this.nega(a,c,d,-f,-e),this.desimulate(a,c,d%2)),m>e&&(e=m),e>=f)return e;l=e+1}return e},f.move=function(){f.cache={};for(var a,b=-1/0,c=1/0,d=[this.scorequeue[0].r,this.scorequeue[0].c],e=20,g=[],h=this.depth;e--;)a=this.scorequeue[e],a.score.set||(g.push(a.c),g.push(a.r));e=g.length-1;var i,j,k=c;i=g[e],j=g[--e];var l=-this.nega(i,j,h,-k,-b);for(this.desimulate(i,j,h%2),l>b&&(b=l,d=[i,j]),k=b+1;e--;)i=g[e],j=g[--e],l=-this.nega(i,j,h,-k,-b),this.desimulate(i,j,h%2),l>b&&c>l&&(l=-this.nega(i,j,h,-c,-b),this.desimulate(i,j,h%2)),l>b&&(b=l,d=[i,j]),k=b+1;return d},this.iniComputer=c,this.informingComputer=d,this.getMove=e});
//# sourceMappingURL=everything.min.js.map